[pytest]
# ===================================
# Pytest Configuration for IB API Tests
# ===================================

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = .

# Minimum Python version
minversion = 6.0

# Add options to command line
addopts =
    # Verbose output
    -v
    # Show summary of all test outcomes
    -ra
    # Show local variables in tracebacks
    --showlocals
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Warnings
    -W ignore::DeprecationWarning
    # Coverage (optional - uncomment to enable)
    # --cov=.
    # --cov-report=html
    # --cov-report=term-missing

# Test markers
markers =
    # Test categories
    connection: Tests for IB Gateway/TWS connection
    account: Tests for account data retrieval
    market_data: Tests for market data retrieval
    contracts: Tests for contract creation and validation
    orders: Tests for order placement and management
    execution: Tests for execution algorithms (TWAP, VWAP, etc.)
    error_handling: Tests for error handling and recovery
    integration: End-to-end integration tests

    # Test characteristics
    slow: Tests that take longer than 5 seconds
    fast: Tests that complete quickly (< 1 second)
    requires_market_hours: Tests that require market to be open
    requires_order_placement: Tests that place actual orders (even in paper trading)

    # Safety markers
    safe: Tests that only read data, no modifications
    destructive: Tests that modify state or place orders

    # Priority markers
    critical: Critical tests that must always pass
    smoke: Quick smoke tests for basic functionality

# Console output options
console_output_style = progress

# Log settings
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = results/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Timeout for tests (seconds)
# Requires pytest-timeout plugin
# timeout = 60

# Asyncio mode
# Requires pytest-asyncio plugin
# asyncio_mode = auto

# Ignore paths
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .pytest_cache
    results

# Custom test collection
# testpaths can be overridden via command line

# Environment variables for tests
# (Can be overridden by actual environment variables)
# env =
#     IB_HOST=127.0.0.1
#     IB_PORT=7497
#     IB_CLIENT_ID=1

# ===================================
# Example Usage:
# ===================================
#
# Run all tests:
#   pytest
#
# Run specific test category:
#   pytest -m connection
#   pytest -m "account and not slow"
#
# Run specific test file:
#   pytest tests/ib_api/basic/test_01_connection.py
#
# Run with verbose output:
#   pytest -vv
#
# Run with live logging:
#   pytest --log-cli-level=DEBUG
#
# Run only fast tests:
#   pytest -m fast
#
# Run all except slow tests:
#   pytest -m "not slow"
#
# Run critical smoke tests:
#   pytest -m "critical and smoke"
#
# Run with keyword filter:
#   pytest -k "connection or account"
#
# Stop after first failure:
#   pytest -x
#
# Run failed tests from last run:
#   pytest --lf
#
# Run failed tests first, then others:
#   pytest --ff
#
# ===================================
